<script type="text/javascript" src="https://www.google.com/jsapi"></script>


<script type="text/javascript">
 var theme = 'bootstrap';
 $("#optionsExpander").jqxExpander({ width: '100%', theme: theme,  expanded: false});
 
</script>
<script type="text/javascript">

     $("#downloadButton").jqxButton({ width: '200'});                
      $("#downloadButton").on('click', function () {
                var json = $.parseJSON(getData(limit));
    		var csv = JSON2CSV(json);

	        downloadWithName("data:text/csv;charset=utf-8," + escape(csv), "demography_data.csv");
      }); 
	
	
     function getData(limit){
      var params = {"limit": limit};
      var jsonData = $.ajax({
          url: "freelancerdemography_getdata",
          dataType:"json",
          type: "POST",
          data: JSON.stringify(params),
          async: false
          }).responseText;
       return jsonData;    
     }	
     function drawChart(limit) {
      
      var jsonData = getData(limit);

       //$("#output").html(jsonData);
      var data = new google.visualization.arrayToDataTable($.parseJSON(jsonData));
      
      
	 var options = {
          title:"Freelancers Demography",width: '100%', height: 600, is3D: true,
          //legend: 'none',
          sliceVisibilityThreshold: 1/200,
          pieSliceText: 'percentage',
          slices: {  4: {offset: 0.1},
                    1: {offset: 0.1},
                    2: {offset: 0.1},
                    3: {offset: 0.1},
          },
        };


      var chart = new google.visualization.PieChart(document.getElementById('visualization'));
      
      chart.draw(data, options);
      
      var tablearea = new google.visualization.Table(document.getElementById('tablearea'));
      tablearea.draw(data,null);
      
      var options = {
        //region: 'SA',
        height: 500,
        colorAxis: {colors: ['white', 'blue']}
      };
      var chart = new google.visualization.GeoChart(document.getElementById('maps'));
      chart.draw(data, options);
    }
	
		
    drawChart("1000");
</script>

 <div id='optionsExpander'>
            <div>Options</div>
            <div>
               <input type="button" value="Download CSV" id='downloadButton' />
            </div>
        </div>
<div style="padding: 20px 20px 20px 20px">
<div id="visualization" style="width: 100%; height:600px; float: left;"></div>
<div id="maps" style="width: 100%; height:100%; float: left;"></div>
<div id="tablearea" style="width: 100%; height:100%; float: left;"></div>
<div id="output"></div>
</div>

              
    

