<!DOCTYPE html>

<html>
  <head>
    <title>Nabbesh Visualization</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Bootstrap -->
    <link href="/site_media/css/bootstrap.min.css" rel="stylesheet" media="screen">
    <script src="http://maps.google.com/maps/api/js?sensor=false" type="text/javascript"></script>
    <script src="https://maps.googleapis.com/maps/api/js?v=3.exp&sensor=false&libraries=visualization"></script>
    

    <link rel="stylesheet" href="/site_media/jqwid/jqwidgets/styles/jqx.base.css" type="text/css" />
    <script type="text/javascript" src="/site_media/jqwid/scripts/gettheme.js"></script>
    <script type="text/javascript" src="/site_media/jqwid/scripts/jquery-1.8.3.min.js"></script>
    <script type="text/javascript" src="/site_media/jqwid/jqwidgets/jqxcore.js"></script>
    <script type="text/javascript" src="/site_media/jqwid/jqwidgets/jqxbuttons.js"></script>
    <script type="text/javascript" src="/site_media/jqwid/jqwidgets/jqxscrollbar.js"></script>
    <script type="text/javascript" src="/site_media/jqwid/jqwidgets/jqxlistbox.js"></script>
    <script type="text/javascript" src="/site_media/jqwid/jqwidgets/jqxcheckbox.js"></script>

    <script type="text/javascript">
    //<![CDATA[

    var customIcons = {
      employer: {
        icon: 'http://labs.google.com/ridefinder/images/mm_20_red.png',
        shadow: 'http://labs.google.com/ridefinder/images/mm_20_shadow.png'
      },
      freelancer: {
        icon: 'https://s3-eu-west-1.amazonaws.com/nabbesh-images/static/images/favicon.ico',
        shadow: 'http://labs.google.com/ridefinder/images/mm_20_shadow.png'
      }
    };

    function loadmap(showmarkers) {
      var map = new google.maps.Map(document.getElementById("map"), {
        center: new google.maps.LatLng(27.43029,48.955078),
        zoom: 5,
        mapTypeId: 'roadmap'
      });

      var map, pointarray, heatmap,pointsdata = new Array();
      var infoWindow = new google.maps.InfoWindow;

      // Change this depending on the name of your PHP file
      downloadUrl("userlist", function(data) {
        var xml = data.responseXML;

        var  nabbeshers = xml.documentElement.getElementsByTagName("marker");
        for (var i = 0; i < nabbeshers.length; i++) {
                pointsdata.push(new google.maps.LatLng(parseFloat(nabbeshers[i].getAttribute("lat")),parseFloat(nabbeshers[i].getAttribute("lng"))));
        }
        pointarray = new google.maps.MVCArray(pointsdata);
        heatmap = new google.maps.visualization.HeatmapLayer({
          data: pointarray
        });
        /*heatmap.setOptions({radius: heatmap.get('radius') ? null : 70});
        heatmap.setOptions({opacity: heatmap.get('opacity') ? null : 0.8});
        #heatmap.setMap(map);*/
        if (showmarkers==true){
        var markers = xml.documentElement.getElementsByTagName("marker");
        //alert(markers.length);
        for (var i = 0; i < markers.length; i++){
          var name = markers[i].getAttribute("name");
          var email = markers[i].getAttribute("email");
          var type = markers[i].getAttribute("type");
          var point = new google.maps.LatLng(
              parseFloat(markers[i].getAttribute("lat")),
              parseFloat(markers[i].getAttribute("lng")));
          var html1 = markers[i].getAttribute("photo");
          var html = "<b>" + name + "</b> <br/>" + email + "<br/>"+ "<img width=150 height=150 src=" +html1 +">";
          var icon = customIcons[type] || {};
          var marker = new google.maps.Marker({
            map: map,
            position: point,
            icon: icon.icon,
            shadow: icon.shadow
          });
          marker.setMap(map);
          $('#load').width(422*i/markers.length);
        
          bindInfoWindow(marker, map, infoWindow, html);
        }
        }
     });
    }

    function setprogress(percent){
       $('#load').text($('#load').width()/4 + "%");
       $('#load').width($('#load').width()+4);
    }
    function prepareoptions(){
        var data = {};

        $('showmrh.btn.active').each(function() {
            data[this.name] = this.value;
        });
        return data;
    }

    function bindInfoWindow(marker, map, infoWindow, html) {
        google.maps.event.addListener(marker, 'click', function() {
        infoWindow.setContent(html);
        infoWindow.open(map, marker);
      });
    }
    function createInfoWindow(poly,content) {
        google.maps.event.addListener(poly, 'click', function(event) {
        infowindow.content = content;
        infowindow.position = event.latLng;
        infowindow.open(map);
      });
    }

    function downloadUrl(url, callback) {
      var request = window.ActiveXObject ?
          new ActiveXObject('Microsoft.XMLHTTP') :
          new XMLHttpRequest;

      request.onreadystatechange = function() {
        if (request.readyState == 4) {
          request.onreadystatechange = doNothing;
          callback(request, request.status);
        }
      };

      request.open('GET', url, true);
      request.send(null);
    }

    function doNothing() {}

    //]]>
  </script>

    <script src="http://code.jquery.com/jquery.js"></script>
    <script src="/site_media/js/bootstrap.min.js"></script>

  </head>

